{"version":3,"file":"CommentItem-3415ae30.js","sources":["../../src/CommentItem/CommentItem.tsx"],"sourcesContent":["import { createRef, useEffect, useState } from 'react'\nimport { Box, Flex, Text } from 'theme-ui'\n\nimport { Button } from '../Button/Button'\nimport { ConfirmModal } from '../ConfirmModal/ConfirmModal'\nimport { EditComment } from '../EditComment/EditComment'\nimport { LinkifyText } from '../LinkifyText/LinkifyText'\nimport { Modal } from '../Modal/Modal'\nimport { Username } from '../Username/Username'\n\nimport type { IComment } from './types'\n\nconst SHORT_COMMENT = 129\n\nexport interface CommentItemProps {\n  comment: IComment\n  handleDelete?: (commentId: string) => Promise<void>\n  handleEdit?: (commentId: string, newCommentText: string) => void\n  handleEditRequest?: (commentId: string) => Promise<void>\n  isReply: boolean\n}\n\nconst formatDate = (d: string | undefined): string => {\n  if (!d) {\n    return ''\n  }\n  return new Date(d).toLocaleDateString('en-GB').replace(/\\//g, '-')\n}\n\nexport const CommentItem = (props: CommentItemProps) => {\n  const textRef = createRef<any>()\n  const [showEditModal, setShowEditModal] = useState(false)\n  const [showDeleteModal, setShowDeleteModal] = useState(false)\n  const [textHeight, setTextHeight] = useState(0)\n  const [isShowMore, setShowMore] = useState(false)\n  const { comment, handleDelete, handleEditRequest, handleEdit, isReply } =\n    props\n  const {\n    text,\n    creatorName,\n    creatorCountry,\n    isUserVerified,\n    isUserSupporter,\n    isEditable,\n    _created,\n    _edited,\n    _id,\n  } = comment\n\n  const date = formatDate(_edited || _created)\n  const maxHeight = isShowMore ? 'max-content' : '128px'\n\n  useEffect(() => {\n    if (textRef.current) {\n      setTextHeight(textRef.current.scrollHeight)\n    }\n  }, [textRef])\n\n  const showMore = () => {\n    setShowMore(!isShowMore)\n  }\n\n  const onEditRequest = (_id: string) => {\n    if (handleEditRequest) {\n      handleEditRequest(_id)\n      return setShowEditModal(true)\n    }\n  }\n\n  return (\n    <Box id={`comment:${_id}`} data-cy=\"comment\">\n      <Flex\n        sx={{\n          flexDirection: 'column',\n        }}\n      >\n        <Flex\n          sx={{\n            alignItems: 'stretch',\n            flexDirection: 'row',\n            flexWrap: 'wrap',\n            justifyContent: 'flex-start',\n          }}\n        >\n          <Flex sx={{ alignItems: 'baseline', gap: 2 }}>\n            <Username\n              user={{\n                userName: creatorName,\n                countryCode: creatorCountry,\n                isVerified: !!isUserVerified,\n                isSupporter: !!isUserSupporter,\n              }}\n            />\n            {_edited && (\n              <Text sx={{ fontSize: 0, color: 'grey' }}>(Edited)</Text>\n            )}\n            <Text sx={{ fontSize: 1 }}>{date}</Text>\n          </Flex>\n\n          <Flex\n            sx={{\n              flexGrow: 1,\n              gap: 2,\n              justifyContent: ['flex-start', 'flex-start', 'flex-end'],\n              opacity: 0.5,\n              width: ['100%', 'auto'],\n              ':hover': { opacity: 1 },\n            }}\n          >\n            {isEditable && (\n              <>\n                <Button\n                  data-cy=\"CommentItem: edit button\"\n                  variant=\"outline\"\n                  small={true}\n                  icon=\"edit\"\n                  onClick={() => onEditRequest(_id)}\n                >\n                  edit\n                </Button>\n                <Button\n                  data-cy=\"CommentItem: delete button\"\n                  variant={'outline'}\n                  small={true}\n                  icon=\"delete\"\n                  onClick={() => setShowDeleteModal(true)}\n                >\n                  delete\n                </Button>\n              </>\n            )}\n          </Flex>\n        </Flex>\n        <Text\n          data-cy=\"comment-text\"\n          mt={2}\n          mb={2}\n          sx={{\n            fontFamily: 'body',\n            lineHeight: 1.3,\n            maxHeight,\n            overflow: 'hidden',\n            whiteSpace: 'pre-wrap',\n            wordBreak: 'break-word',\n          }}\n          ref={textRef}\n        >\n          <LinkifyText>{text}</LinkifyText>\n        </Text>\n        {textHeight > SHORT_COMMENT && (\n          <a\n            onClick={showMore}\n            style={{\n              color: 'gray',\n              cursor: 'pointer',\n              fontSize: '14px',\n            }}\n          >\n            {isShowMore ? 'Show less' : 'Show more'}\n          </a>\n        )}\n\n        <Modal width={600} isOpen={showEditModal}>\n          <EditComment\n            comment={text}\n            handleSubmit={(commentText) => {\n              handleEdit && handleEdit(_id, commentText)\n              setShowEditModal(false)\n            }}\n            handleCancel={() => setShowEditModal(false)}\n            isReply={isReply}\n          />\n        </Modal>\n\n        <ConfirmModal\n          isOpen={showDeleteModal}\n          message=\"Are you sure you want to delete this comment?\"\n          confirmButtonText=\"Delete\"\n          handleCancel={() => setShowDeleteModal(false)}\n          handleConfirm={() => {\n            handleDelete && handleDelete(_id)\n            setShowDeleteModal(false)\n          }}\n        />\n      </Flex>\n    </Box>\n  )\n}\n"],"names":["SHORT_COMMENT","formatDate","d","CommentItem","props","textRef","createRef","showEditModal","setShowEditModal","useState","showDeleteModal","setShowDeleteModal","textHeight","setTextHeight","isShowMore","setShowMore","comment","handleDelete","handleEditRequest","handleEdit","isReply","text","creatorName","creatorCountry","isUserVerified","isUserSupporter","isEditable","_created","_edited","_id","date","maxHeight","useEffect","showMore","onEditRequest","_id2","jsx","Box","jsxs","Flex","Username","Text","Fragment","Button","LinkifyText","Modal","EditComment","commentText","ConfirmModal"],"mappings":"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"}